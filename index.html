<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#ff6b35">
	<link rel="manifest" href="/manifest-admin.json">
	<link rel="icon" type="image/png" href="/image.png">
	<link rel="apple-touch-icon" href="/image.png">
	<link rel="stylesheet" href="styles.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<title>Admin - Sistema Restaurante</title>
	<style>
		.dashboard-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}
		.stat-card {
			background: linear-gradient(135deg, var(--panel), var(--card));
			padding: 25px;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
			border: 1px solid rgba(255, 107, 53, 0.1);
		}
		.stat-card h3 {
			font-size: 14px;
			color: var(--muted);
			text-transform: uppercase;
			margin-bottom: 10px;
		}
		.stat-card .value {
			font-size: 36px;
			font-weight: 700;
			color: var(--accent);
		}
		.section {
			display: none;
		}
		.section.active {
			display: block;
		}
		.order-card {
			background: rgba(0, 0, 0, 0.3);
			padding: 15px;
			border-radius: 8px;
			margin-bottom: 15px;
			border-left: 4px solid var(--accent);
		}
		.order-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}
		.order-items-list {
			margin: 10px 0;
			padding: 10px;
			background: rgba(0, 0, 0, 0.2);
			border-radius: 6px;
		}
		.order-item-line {
			display: flex;
			justify-content: space-between;
			padding: 5px 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.05);
		}
		.close-cash-summary {
			background: linear-gradient(135deg, var(--success), #388e3c);
			color: #fff;
			padding: 30px;
			border-radius: 12px;
			margin-top: 20px;
		}
		.close-cash-summary h2 {
			margin-bottom: 20px;
		}
		.close-cash-line {
			display: flex;
			justify-content: space-between;
			padding: 10px 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.2);
			font-size: 18px;
		}
		.close-cash-total {
			font-size: 32px;
			font-weight: 700;
			margin-top: 20px;
			text-align: right;
		}
	</style>
</head>
<body>
	<div class="app">
		<!-- Sidebar -->
		<div class="sidebar">
			<div class="brand">
				<img src="image.png" alt="Logo" style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 10px;">
				<div>Restaurante</div>
				<span>Panel de Control</span>
			</div>
			<ul class="menu">
				<li class="active" onclick="showSection('dashboard')">
					<span class="menu-icon">ğŸ“Š</span> Dashboard
				</li>
				<li onclick="showSection('tables')">
					<span class="menu-icon">ğŸª‘</span> Mesas
				</li>
				<li onclick="showSection('orders')">
					<span class="menu-icon">ğŸ“</span> Pedidos
				</li>
				<li onclick="showSection('menu-config')">
					<span class="menu-icon">ğŸ”</span> MenÃº
				</li>
				<li onclick="showSection('transactions')">
					<span class="menu-icon">ğŸ’°</span> Finanzas
				</li>
				<li onclick="showSection('close-cash')">
					<span class="menu-icon">ğŸ”’</span> Cierre de Caja
				</li>
			</ul>
		</div>

		<!-- Main Content -->
		<div class="main">
			<!-- Dashboard -->
			<div id="dashboard" class="section active">
				<div class="header">
					<h1>Dashboard</h1>
					<button class="btn" onclick="refreshData()">ğŸ”„ Actualizar</button>
				</div>

				<div class="dashboard-grid">
					<div class="stat-card">
						<h3>Mesas Ocupadas</h3>
						<div class="value" id="stat-tables">0</div>
					</div>
					<div class="stat-card">
						<h3>Pedidos Activos</h3>
						<div class="value" id="stat-orders">0</div>
					</div>
					<div class="stat-card">
						<h3>Ventas Hoy</h3>
						<div class="value" id="stat-sales">$0</div>
					</div>
					<div class="stat-card">
						<h3>Total Mes</h3>
						<div class="value" id="stat-month">$0</div>
					</div>
				</div>

				<div class="card">
					<h3>Mesas en Tiempo Real</h3>
					<div class="tables-grid" id="dashboard-tables"></div>
				</div>
			</div>

			<!-- Mesas -->
			<div id="tables" class="section">
				<div class="header">
					<h1>GestiÃ³n de Mesas</h1>
					<button class="btn" onclick="openTableModal()">â• Agregar Mesa</button>
				</div>
				<div class="card">
					<div class="tables-grid" id="tables-list"></div>
				</div>
			</div>

			<!-- Pedidos -->
			<div id="orders" class="section">
				<div class="header">
					<h1>Pedidos Activos</h1>
					<div class="controls">
						<button class="btn btn-success" onclick="refreshData()">ğŸ”„ Actualizar</button>
					</div>
				</div>
				<div class="card" id="orders-list"></div>
			</div>

			<!-- ConfiguraciÃ³n de MenÃº -->
			<div id="menu-config" class="section">
				<div class="header">
					<h1>ConfiguraciÃ³n del MenÃº</h1>
					<button class="btn" onclick="openMenuItemModal()">â• Nuevo Producto</button>
				</div>
				<div class="card">
					<div class="table-scroll">
						<table id="menu-table">
							<thead>
								<tr>
									<th>Nombre</th>
									<th>DescripciÃ³n</th>
									<th>CategorÃ­a</th>
									<th>Precio</th>
									<th>Disponible</th>
									<th>Acciones</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
			</div>

			<!-- Finanzas -->
			<div id="transactions" class="section">
				<div class="header">
					<h1>Historial de Transacciones</h1>
				</div>
				<div class="card">
					<div class="table-scroll">
						<table id="transactions-table">
							<thead>
								<tr>
									<th>Fecha</th>
									<th>Mesa</th>
									<th>Concepto</th>
									<th>Monto</th>
									<th>Acciones</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
			</div>

			<!-- Cierre de Caja -->
			<div id="close-cash" class="section">
				<div class="header">
					<h1>Cierre de Caja</h1>
					<button class="btn btn-warning" onclick="generateCloseCash()">ğŸ“„ Generar Cierre</button>
				</div>
				<div class="card">
					<div id="close-cash-content">
						<p class="text-center" style="color: var(--muted); padding: 40px;">
							Haz clic en "Generar Cierre" para ver el resumen del dÃ­a
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Mesa -->
	<div id="table-modal" class="modal">
		<div class="panel">
			<div class="modal-header">
				<h3 id="table-modal-title">Nueva Mesa</h3>
				<button class="modal-close" onclick="closeTableModal()">âœ•</button>
			</div>
			<div class="form-row">
				<div class="form-group" style="flex: 1;">
					<label>NÃºmero de Mesa</label>
					<input type="number" id="table-number" placeholder="1">
				</div>
				<div class="form-group" style="flex: 1;">
					<label>Capacidad</label>
					<input type="number" id="table-capacity" placeholder="4">
				</div>
			</div>
			<div class="controls">
				<button class="btn" onclick="saveTable()">ğŸ’¾ Guardar</button>
				<button class="btn btn-secondary" onclick="closeTableModal()">Cancelar</button>
			</div>
		</div>
	</div>

	<!-- Modal Producto MenÃº -->
	<div id="menu-item-modal" class="modal">
		<div class="panel">
			<div class="modal-header">
				<h3 id="menu-item-modal-title">Nuevo Producto</h3>
				<button class="modal-close" onclick="closeMenuItemModal()">âœ•</button>
			</div>
			<div class="form-group">
				<label>Nombre</label>
				<input type="text" id="item-name" placeholder="Ej: Hamburguesa ClÃ¡sica">
			</div>
			<div class="form-group">
				<label>DescripciÃ³n</label>
				<textarea id="item-description" placeholder="DescripciÃ³n del producto"></textarea>
			</div>
			<div class="form-row">
				<div class="form-group" style="flex: 1;">
					<label>CategorÃ­a</label>
					<input type="text" id="item-category" placeholder="Ej: Hamburguesas">
				</div>
				<div class="form-group" style="flex: 1;">
					<label>Precio</label>
					<input type="number" id="item-price" placeholder="0.00" step="0.01">
				</div>
			</div>
			<div class="form-group">
				<label>
					<input type="checkbox" id="item-available" checked> Disponible
				</label>
			</div>
			<div class="controls">
				<button class="btn" onclick="saveMenuItem()">ğŸ’¾ Guardar</button>
				<button class="btn btn-secondary" onclick="closeMenuItemModal()">Cancelar</button>
			</div>
		</div>
	</div>

	<script src="app.js"></script>
	<script>
		let currentEditingTable = null;
		let currentEditingMenuItem = null;

		async function init() {
			await loadInitialData();
			await initializeDefaultData();
			renderDashboard();
			renderAllSections();
		}

		function showSection(sectionId) {
			document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
			document.getElementById(sectionId).classList.add('active');
			document.querySelectorAll('.menu li').forEach(li => li.classList.remove('active'));
			event.target.closest('li').classList.add('active');
			
			if (sectionId === 'dashboard') renderDashboard();
			if (sectionId === 'tables') renderTables();
			if (sectionId === 'orders') renderOrders();
			if (sectionId === 'menu-config') renderMenuConfig();
			if (sectionId === 'transactions') renderTransactions();
		}

		async function refreshData() {
			await loadInitialData();
			renderAllSections();
			Utils.showNotification('Datos actualizados', 'success');
		}

		function renderAllSections() {
			renderDashboard();
			renderTables();
			renderOrders();
			renderMenuConfig();
			renderTransactions();
		}

		// DASHBOARD
		function renderDashboard() {
			const occupiedTables = AppState.tables.filter(t => t.status === 'occupied').length;
			const activeOrders = AppState.orders.filter(o => o.status === 'pending').length;
			
			const today = new Date().toISOString().split('T')[0];
			const todaySales = AppState.transactions
				.filter(t => t.date && t.date.startsWith(today))
				.reduce((sum, t) => sum + (t.amount || 0), 0);
			
			const thisMonth = new Date().toISOString().slice(0, 7);
			const monthSales = AppState.transactions
				.filter(t => t.date && t.date.startsWith(thisMonth))
				.reduce((sum, t) => sum + (t.amount || 0), 0);

			document.getElementById('stat-tables').textContent = occupiedTables;
			document.getElementById('stat-orders').textContent = activeOrders;
			document.getElementById('stat-sales').textContent = Utils.formatCurrency(todaySales);
			document.getElementById('stat-month').textContent = Utils.formatCurrency(monthSales);

			const container = document.getElementById('dashboard-tables');
			container.innerHTML = AppState.tables.map(table => `
				<div class="table-card ${table.status}">
					<div class="table-number">Mesa ${table.number}</div>
					<div class="table-status">
						${table.status === 'available' ? 'âœ… Disponible' : 
						  table.status === 'occupied' ? 'ğŸ”´ Ocupada' : 'ğŸ“ Reservada'}
					</div>
				</div>
			`).join('');
		}

		// MESAS
		function renderTables() {
			const container = document.getElementById('tables-list');
			container.innerHTML = AppState.tables.map(table => `
				<div class="table-card ${table.status}">
					<div class="table-number">Mesa ${table.number}</div>
					<div class="table-status">Capacidad: ${table.capacity} personas</div>
					<div class="table-status">
						${table.status === 'available' ? 'âœ… Disponible' : 
						  table.status === 'occupied' ? 'ğŸ”´ Ocupada' : 'ğŸ“ Reservada'}
					</div>
					<div style="margin-top: 10px; display: flex; gap: 5px; justify-content: center;">
						<button class="btn btn-small btn-secondary" onclick="editTable('${table.id}')">âœï¸</button>
						<button class="btn btn-small btn-danger" onclick="deleteTable('${table.id}')">ğŸ—‘ï¸</button>
						${table.status === 'occupied' ? 
							`<button class="btn btn-small btn-success" onclick="freeTable('${table.id}')">âœ“ Liberar</button>` : ''}
					</div>
				</div>
			`).join('');
		}

		function openTableModal(tableId = null) {
			if (tableId) {
				currentEditingTable = AppState.tables.find(t => t.id === tableId);
				document.getElementById('table-modal-title').textContent = 'Editar Mesa';
				document.getElementById('table-number').value = currentEditingTable.number;
				document.getElementById('table-capacity').value = currentEditingTable.capacity;
			} else {
				currentEditingTable = null;
				document.getElementById('table-modal-title').textContent = 'Nueva Mesa';
				document.getElementById('table-number').value = '';
				document.getElementById('table-capacity').value = '4';
			}
			document.getElementById('table-modal').classList.add('show');
		}

		function closeTableModal() {
			document.getElementById('table-modal').classList.remove('show');
			currentEditingTable = null;
		}

		function editTable(tableId) {
			openTableModal(tableId);
		}

		async function saveTable() {
			const number = parseInt(document.getElementById('table-number').value);
			const capacity = parseInt(document.getElementById('table-capacity').value);

			if (!number || !capacity) {
				Utils.showNotification('Completa todos los campos', 'warning');
				return;
			}

			if (currentEditingTable) {
				currentEditingTable.number = number;
				currentEditingTable.capacity = capacity;
				const index = AppState.tables.findIndex(t => t.id === currentEditingTable.id);
				AppState.tables[index] = currentEditingTable;
			} else {
				AppState.tables.push({
					id: Utils.generateId(),
					number,
					capacity,
					status: 'available',
					currentOrder: null
				});
			}

			await API.save('tables', AppState.tables);
			closeTableModal();
			renderTables();
			renderDashboard();
			Utils.showNotification('Mesa guardada', 'success');
		}

		async function deleteTable(tableId) {
			if (!confirm('Â¿Eliminar esta mesa?')) return;
			AppState.tables = AppState.tables.filter(t => t.id !== tableId);
			await API.save('tables', AppState.tables);
			renderTables();
			renderDashboard();
			Utils.showNotification('Mesa eliminada', 'success');
		}

		async function freeTable(tableId) {
			if (!confirm('Â¿Liberar esta mesa?')) return;
			const table = AppState.tables.find(t => t.id === tableId);
			if (table) {
				table.status = 'available';
				table.currentOrder = null;
				await API.save('tables', AppState.tables);
				renderTables();
				renderDashboard();
				Utils.showNotification('Mesa liberada', 'success');
			}
		}

		// PEDIDOS
		function renderOrders() {
			const container = document.getElementById('orders-list');
			const activeOrders = AppState.orders.filter(o => o.status === 'pending');
			
			if (activeOrders.length === 0) {
				container.innerHTML = '<p class="text-center" style="color: var(--muted); padding: 40px;">No hay pedidos activos</p>';
				return;
			}

			container.innerHTML = activeOrders.map(order => `
				<div class="order-card">
					<div class="order-header">
						<div>
							<strong style="color: var(--accent);">Mesa ${order.tableNumber}</strong>
							<div class="small">${Utils.formatDate(order.createdAt)}</div>
						</div>
						<div>
							<span class="badge badge-warning">Pendiente</span>
						</div>
					</div>
					<div class="order-items-list">
						${order.items.map(item => `
							<div class="order-item-line">
								<div>${item.quantity}x ${item.name} ${item.notes ? `<br><small style="color: var(--muted);">Nota: ${item.notes}</small>` : ''}</div>
								<div>${Utils.formatCurrency(item.price * item.quantity)}</div>
							</div>
						`).join('')}
					</div>
					<div style="text-align: right; font-size: 20px; font-weight: 700; color: var(--success); margin-top: 10px;">
						Total: ${Utils.formatCurrency(order.total)}
					</div>
					<div style="margin-top: 15px; display: flex; gap: 10px;">
						<button class="btn btn-success" onclick="completeOrder('${order.id}')">âœ“ Completar y Facturar</button>
						<button class="btn btn-danger" onclick="cancelOrder('${order.id}')">âœ• Cancelar</button>
					</div>
				</div>
			`).join('');
		}

		async function completeOrder(orderId) {
			const order = AppState.orders.find(o => o.id === orderId);
			if (!order) return;

			// Generar PDF antes de completar
			await generateInvoicePDF(order);

			// Marcar como completado
			order.status = 'completed';
			order.completedAt = new Date().toISOString();

			// Agregar transacciÃ³n
			AppState.transactions.push({
				id: Utils.generateId(),
				orderId: order.id,
				tableNumber: order.tableNumber,
				amount: order.total,
				type: 'sale',
				date: new Date().toISOString(),
				concept: `Mesa ${order.tableNumber} - ${order.items.length} productos`
			});

			// Liberar mesa
			const table = AppState.tables.find(t => t.id === order.tableId);
			if (table) {
				table.status = 'available';
				table.currentOrder = null;
			}

			await API.save('orders', AppState.orders);
			await API.save('transactions', AppState.transactions);
			await API.save('tables', AppState.tables);

			renderOrders();
			renderDashboard();
			renderTransactions();
			Utils.showNotification('Pedido completado y facturado', 'success');
		}

		async function cancelOrder(orderId) {
			if (!confirm('Â¿Cancelar este pedido?')) return;
			const order = AppState.orders.find(o => o.id === orderId);
			if (!order) return;

			order.status = 'cancelled';
			
			const table = AppState.tables.find(t => t.id === order.tableId);
			if (table) {
				table.status = 'available';
				table.currentOrder = null;
			}

			await API.save('orders', AppState.orders);
			await API.save('tables', AppState.tables);
			renderOrders();
			renderDashboard();
			Utils.showNotification('Pedido cancelado', 'success');
		}

		// MENÃš CONFIG
		function renderMenuConfig() {
			const tbody = document.querySelector('#menu-table tbody');
			tbody.innerHTML = AppState.menuItems.map(item => `
				<tr>
					<td>${item.name}</td>
					<td>${item.description || '-'}</td>
					<td><span class="badge badge-info">${item.category}</span></td>
					<td>${Utils.formatCurrency(item.price)}</td>
					<td><span class="badge ${item.available ? 'badge-success' : 'badge-danger'}">${item.available ? 'SÃ­' : 'No'}</span></td>
					<td>
						<button class="btn btn-small btn-secondary" onclick="editMenuItem('${item.id}')">âœï¸</button>
						<button class="btn btn-small btn-danger" onclick="deleteMenuItem('${item.id}')">ğŸ—‘ï¸</button>
					</td>
				</tr>
			`).join('');
		}

		function openMenuItemModal(itemId = null) {
			if (itemId) {
				currentEditingMenuItem = AppState.menuItems.find(i => i.id === itemId);
				document.getElementById('menu-item-modal-title').textContent = 'Editar Producto';
				document.getElementById('item-name').value = currentEditingMenuItem.name;
				document.getElementById('item-description').value = currentEditingMenuItem.description || '';
				document.getElementById('item-category').value = currentEditingMenuItem.category;
				document.getElementById('item-price').value = currentEditingMenuItem.price;
				document.getElementById('item-available').checked = currentEditingMenuItem.available;
			} else {
				currentEditingMenuItem = null;
				document.getElementById('menu-item-modal-title').textContent = 'Nuevo Producto';
				document.getElementById('item-name').value = '';
				document.getElementById('item-description').value = '';
				document.getElementById('item-category').value = '';
				document.getElementById('item-price').value = '';
				document.getElementById('item-available').checked = true;
			}
			document.getElementById('menu-item-modal').classList.add('show');
		}

		function closeMenuItemModal() {
			document.getElementById('menu-item-modal').classList.remove('show');
			currentEditingMenuItem = null;
		}

		function editMenuItem(itemId) {
			openMenuItemModal(itemId);
		}

		async function saveMenuItem() {
			const name = document.getElementById('item-name').value.trim();
			const description = document.getElementById('item-description').value.trim();
			const category = document.getElementById('item-category').value.trim();
			const price = parseFloat(document.getElementById('item-price').value);
			const available = document.getElementById('item-available').checked;

			if (!name || !category || !price) {
				Utils.showNotification('Completa los campos requeridos', 'warning');
				return;
			}

			if (currentEditingMenuItem) {
				currentEditingMenuItem.name = name;
				currentEditingMenuItem.description = description;
				currentEditingMenuItem.category = category;
				currentEditingMenuItem.price = price;
				currentEditingMenuItem.available = available;
				const index = AppState.menuItems.findIndex(i => i.id === currentEditingMenuItem.id);
				AppState.menuItems[index] = currentEditingMenuItem;
			} else {
				AppState.menuItems.push({
					id: Utils.generateId(),
					name,
					description,
					category,
					price,
					available
				});
			}

			await API.save('menu_items', AppState.menuItems);
			closeMenuItemModal();
			renderMenuConfig();
			Utils.showNotification('Producto guardado', 'success');
		}

		async function deleteMenuItem(itemId) {
			if (!confirm('Â¿Eliminar este producto?')) return;
			AppState.menuItems = AppState.menuItems.filter(i => i.id !== itemId);
			await API.save('menu_items', AppState.menuItems);
			renderMenuConfig();
			Utils.showNotification('Producto eliminado', 'success');
		}

		// TRANSACCIONES
		function renderTransactions() {
			const tbody = document.querySelector('#transactions-table tbody');
			const sorted = [...AppState.transactions].sort((a, b) => 
				new Date(b.date) - new Date(a.date)
			);
			
			if (sorted.length === 0) {
				tbody.innerHTML = '<tr><td colspan="5" class="text-center" style="color: var(--muted); padding: 40px;">No hay transacciones registradas</td></tr>';
				return;
			}

			tbody.innerHTML = sorted.map(t => `
				<tr>
					<td>${Utils.formatDate(t.date)}</td>
					<td>Mesa ${t.tableNumber || '-'}</td>
					<td>${t.concept}</td>
					<td style="color: var(--success); font-weight: 600;">${Utils.formatCurrency(t.amount)}</td>
					<td>
						<button class="btn btn-small btn-danger" onclick="deleteTransaction('${t.id}')">ğŸ—‘ï¸</button>
					</td>
				</tr>
			`).join('');
		}

		async function deleteTransaction(transactionId) {
			if (!confirm('Â¿Eliminar esta transacciÃ³n?')) return;
			AppState.transactions = AppState.transactions.filter(t => t.id !== transactionId);
			await API.save('transactions', AppState.transactions);
			renderTransactions();
			renderDashboard();
			Utils.showNotification('TransacciÃ³n eliminada', 'success');
		}

		// CIERRE DE CAJA
		function generateCloseCash() {
			const today = new Date().toISOString().split('T')[0];
			const todayTransactions = AppState.transactions.filter(t => t.date && t.date.startsWith(today));
			
			const totalSales = todayTransactions.reduce((sum, t) => sum + (t.amount || 0), 0);
			const totalOrders = todayTransactions.length;
			const completedOrders = AppState.orders.filter(o => 
				o.status === 'completed' && o.completedAt && o.completedAt.startsWith(today)
			).length;

			const container = document.getElementById('close-cash-content');
			container.innerHTML = `
				<div class="close-cash-summary">
					<h2>Cierre de Caja - ${new Date().toLocaleDateString('es-MX')}</h2>
					<div class="close-cash-line">
						<span>Total de Ventas:</span>
						<span>${totalOrders}</span>
					</div>
					<div class="close-cash-line">
						<span>Pedidos Completados:</span>
						<span>${completedOrders}</span>
					</div>
					<div class="close-cash-line">
						<span>Ingreso Bruto:</span>
						<span>${Utils.formatCurrency(totalSales)}</span>
					</div>
					<div class="close-cash-total">
						Total del DÃ­a: ${Utils.formatCurrency(totalSales)}
					</div>
					<div style="margin-top: 20px;">
						<button class="btn" onclick="generateCloseCashPDF()">ğŸ“„ Descargar PDF</button>
					</div>
				</div>
			`;
		}

		// GENERAR PDF FACTURA
		async function generateInvoicePDF(order) {
			const { jsPDF } = window.jspdf;
			const doc = new jsPDF({
				unit: 'mm',
				format: [80, 200] // Formato ticket POS
			});

			doc.setFontSize(16);
			doc.text('RESTAURANTE', 40, 10, { align: 'center' });
			doc.setFontSize(10);
			doc.text('Ticket de Venta', 40, 16, { align: 'center' });
			doc.text('------------------------', 40, 20, { align: 'center' });
			
			doc.setFontSize(9);
			doc.text(`Mesa: ${order.tableNumber}`, 5, 26);
			doc.text(`Fecha: ${new Date(order.createdAt).toLocaleString('es-MX')}`, 5, 31);
			doc.text('------------------------', 40, 35, { align: 'center' });
			
			let y = 40;
			doc.setFontSize(8);
			order.items.forEach(item => {
				doc.text(`${item.quantity}x ${item.name}`, 5, y);
				doc.text(`$${(item.price * item.quantity).toFixed(2)}`, 70, y, { align: 'right' });
				y += 5;
				if (item.notes) {
					doc.setFontSize(7);
					doc.text(`  Nota: ${item.notes}`, 5, y);
					y += 4;
					doc.setFontSize(8);
				}
			});
			
			doc.text('------------------------', 40, y, { align: 'center' });
			y += 5;
			doc.setFontSize(12);
			doc.text(`TOTAL: $${order.total.toFixed(2)}`, 40, y, { align: 'center' });
			y += 7;
			doc.setFontSize(8);
			doc.text('Gracias por su preferencia', 40, y, { align: 'center' });
			
			doc.save(`ticket-mesa-${order.tableNumber}-${Date.now()}.pdf`);
		}

		// GENERAR PDF CIERRE DE CAJA
		function generateCloseCashPDF() {
			const { jsPDF } = window.jspdf;
			const doc = new jsPDF();
			
			const today = new Date().toISOString().split('T')[0];
			const todayTransactions = AppState.transactions.filter(t => t.date && t.date.startsWith(today));
			const totalSales = todayTransactions.reduce((sum, t) => sum + (t.amount || 0), 0);
			
			doc.setFontSize(20);
			doc.text('CIERRE DE CAJA', 105, 20, { align: 'center' });
			doc.setFontSize(12);
			doc.text(`Fecha: ${new Date().toLocaleDateString('es-MX')}`, 105, 30, { align: 'center' });
			doc.text(`Hora: ${new Date().toLocaleTimeString('es-MX')}`, 105, 37, { align: 'center' });
			
			doc.setLineWidth(0.5);
			doc.line(20, 42, 190, 42);
			
			let y = 55;
			doc.setFontSize(14);
			doc.text('Resumen del DÃ­a', 20, y);
			y += 10;
			
			doc.setFontSize(11);
			doc.text(`Total de Transacciones: ${todayTransactions.length}`, 20, y);
			y += 8;
			doc.text(`Ingresos Totales: ${Utils.formatCurrency(totalSales)}`, 20, y);
			y += 15;
			
			doc.setFontSize(14);
			doc.text('Detalle de Transacciones', 20, y);
			y += 8;
			
			doc.setFontSize(9);
			todayTransactions.forEach(t => {
				if (y > 270) {
					doc.addPage();
					y = 20;
				}
				doc.text(`${new Date(t.date).toLocaleTimeString('es-MX')} - Mesa ${t.tableNumber || '-'} - ${Utils.formatCurrency(t.amount)}`, 20, y);
				y += 6;
			});
			
			doc.save(`cierre-caja-${today}.pdf`);
		}

		init();
	</script>
</body>
</html>